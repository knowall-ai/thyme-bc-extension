= Troubleshooting Guide
:toc:

== Common Issues

[cols="1,2", options="header"]
|===
| Problem | Solution

| `404 Not Found` when calling API
| Extension not deployed or wrong environment. Verify deployment in BC Admin Center → Extensions.

| `401 Unauthorized` error
| Azure AD token expired or invalid. Re-authenticate with `az login` or check client credentials.

| `403 Forbidden` on API call
| Missing API permissions. Grant `Dynamics 365 Business Central → API.ReadWrite.All` in Azure Portal.

| Symbols download fails in VS Code
| Check BC environment is accessible. Run `AL: Clear Credentials Cache` and retry.

| Build fails with missing dependencies
| Run `AL: Download Symbols` to fetch latest BC symbols.

| Extension won't publish
| Check `app.json` version is incremented. BC won't reinstall same version.

| GitHub Action fails at `Install-Module`
| Windows runner issue. Ensure `runs-on: windows-latest` in workflow.

| `New-BcAuthContext` returns null
| Client secret expired. Create new secret in Azure AD app registration.

| API returns empty results
| Check company context. Ensure `BC_COMPANY` matches a valid company name.

| `syncMode ForceSync` error
| Breaking schema changes. May need to uninstall extension first, then reinstall.

| Deployment works but API not visible
| Wait 1-2 minutes for BC to register new API endpoints after deployment.

| `Job` table not found in symbols
| Using wrong BC version. Check `platform` and `application` versions in `app.json`.

| `Compile-AppInBcContainer : A parameter cannot be found that matches parameter name 'authContext'`
| Wrong function for BC Online. Use `Download-Artifacts` to get `alc.exe`, download symbols via dev API, compile with `alc.exe`, then deploy with `Publish-PerTenantExtensionApps`.

| `Publish-BcContainerApp` fails for BC SaaS
| Use `Publish-PerTenantExtensionApps` for BC Online environments instead of `Publish-BcContainerApp`.

| `401 Unauthorized` with `Authentication_InvalidCredentials` when publishing
| Azure AD app missing `Automation.ReadWrite.All` permission. Add this in Azure Portal → App registrations → API permissions → Dynamics 365 Business Central → Application permissions → `Automation.ReadWrite.All`, then grant admin consent.

| `-schemaSyncMode ForceSync` validation error
| Use `-schemaSyncMode Force` instead. Valid values are `Add` or `Force`.

| `401 Unauthorized` even with correct Azure AD permissions
| App not authorized in BC Admin Center. Go to BC Admin Center → Microsoft Entra Apps → Authorize Microsoft Entra app → enter Client ID → Save. This is required in addition to Azure Portal API permissions.

| `Authentication_InvalidCredentials` even after BC Admin Center authorization
| *Most common cause*: App not configured inside Business Central itself. BC Admin Center authorization is for tenant-level access only. For the Automation API, you must ALSO configure the app in Business Central: Open BC → search for "Microsoft Entra applications" → New → enter Client ID → set State to Enabled → add permission sets `D365 AUTOMATION` and `EXTEN. MGT. - ADMIN`. See https://learn.microsoft.com/en-us/dynamics365/business-central/dev-itpro/administration/automation-apis-using-s2s-authentication[Microsoft S2S Authentication Docs].

| BC Admin Center "Grant" button doesn't change to "Authorized" after clicking
| This requires the *Cloud Application Administrator* role in Azure AD (not just Dynamics 365 Administrator). However, you can proceed anyway - the more critical step is configuring the app inside Business Central itself with the "Microsoft Entra applications" page and assigning permission sets.

| `AADSTS500113: No reply address is registered for the application`
| Azure AD app missing redirect URI. Go to Azure Portal → App registrations → your app → Authentication → Add platform → Web → enter `https://businesscentral.dynamics.com/OAuthLanding.htm` → Configure.

| `404 Not Found` when uploading extension via Automation API
| The extension upload endpoint requires a 3-step process: (1) POST to `/extensionUpload` to create upload object, (2) PATCH to `/extensionUpload({id})/extensionContent` with the .app file bytes, (3) POST to `/extensionUpload({id})/Microsoft.NAV.upload` to trigger installation. A single POST to `/extensionUpload/Microsoft.NAV.upload` will return 404.

| Extension deployment fails with "Unable to publish app" but no error message in API
| *Version mismatch*: Your `app.json` targets a different BC version than your environment. Check `platform` and `application` values in `app.json` against your BC version. For example, if BC runs 27.2.x but `app.json` has `"platform": "24.0.0.0"`, update to `"platform": "27.0.0.0"`. The BC Automation API doesn't return detailed errors - you must view the Extension Deployment Status page in BC to see the actual error.

| Extension upload fails with generic error, no details in API
| *Placeholder app ID*: If your `app.json` has a placeholder ID like `"id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890"`, BC will reject the upload. Generate a proper unique GUID using `uuidgen` (Linux/Mac) or `[guid]::NewGuid()` (PowerShell) and replace the placeholder.
|===

== Getting Help

* https://github.com/knowall-ai/thyme-bc-extension/issues[Open an Issue]
* https://learn.microsoft.com/en-us/dynamics365/business-central/dev-itpro/developer/devenv-develop-custom-api[Microsoft BC API Docs]
